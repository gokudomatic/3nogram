[gd_scene load_steps=4 format=2]

[ext_resource path="res://textures/abstract-art-decoration-1029624.jpg" type="Texture" id=1]
[ext_resource path="res://textures/full_button_font.tres" type="DynamicFont" id=2]

[sub_resource type="GDScript" id=1]

script/source = "extends Control

const puzzle_selection_scene=preload(\"res://PuzzleSelection.tscn\")
const list_item_class=preload(\"res://ListItem.tscn\")

func _ready():
	get_tree().call_group(\"sfx\",\"set_music\",\"menu.ogg\")
	refresh_collection_list()


func _on_BackBtn_pressed():
	get_tree().call_group(\"sfx\",\"play\",\"select\")
	get_tree().change_scene(\"res://MainMenu.tscn\")

func _on_ImportWindowBtn_pressed():
	get_tree().call_group(\"sfx\",\"play\",\"select\")
	get_tree().change_scene(\"res://ImportManager.tscn\")

func refresh_collection_list():
	var container=$ScrollContainer/PuzzleSetList
	# clear container
	while container.get_child_count()>0:
		container.remove_child(container.get_child(0))
	
	var item=list_item_class.instance()
	item.text=\"my puzzles\"
	item.allow_delete=true
	item.value=game_data.my_puzzles
	item.connect(\"selected\",self,\"on_item_pressed\")
	item.connect(\"deleted\",self,\"on_item_deleted\")
	container.add_child(item)
	
	# fill container with all sets	
	for author in game_data.puzzle_collections.keys():
		item=list_item_class.instance()
		item.text=author
		item.allow_delete=true
		item.value=game_data.puzzle_collections[author]
		item.connect(\"selected\",self,\"on_item_pressed\")
		item.connect(\"deleted\",self,\"on_item_deleted\")
		container.add_child(item)

func on_item_pressed(source):
	game_data.current_collection=source.value
	get_tree().call_group(\"sfx\",\"play\",\"select\")
	var instance=puzzle_selection_scene.instance()
	instance.generate_list(source.value)
	get_tree().get_root().add_child(instance)
	get_tree().set_current_scene( instance )
	queue_free()

func on_item_deleted(source):
	get_tree().call_group(\"sfx\",\"play\",\"select\")
	game_data.delete_collection(source.value.author)
	$ScrollContainer/PuzzleSetList.remove_child(source)
	source.queue_free()
	game_data.save_to_file()"

[node name="LevelSelection" type="Control" index="0"]

anchor_left = 0.0
anchor_top = 0.0
anchor_right = 1.0
anchor_bottom = 1.0
rect_pivot_offset = Vector2( 0, 0 )
rect_clip_content = false
mouse_filter = 0
mouse_default_cursor_shape = 0
size_flags_horizontal = 1
size_flags_vertical = 1
script = SubResource( 1 )

[node name="TextureRect" type="TextureRect" parent="." index="0"]

anchor_left = 0.0
anchor_top = 0.0
anchor_right = 1.0
anchor_bottom = 1.0
rect_pivot_offset = Vector2( 0, 0 )
rect_clip_content = false
mouse_filter = 1
mouse_default_cursor_shape = 0
size_flags_horizontal = 1
size_flags_vertical = 1
texture = ExtResource( 1 )
expand = true
stretch_mode = 0

[node name="BackBtn" type="Button" parent="." index="1"]

anchor_left = 0.0
anchor_top = 1.0
anchor_right = 0.0
anchor_bottom = 1.0
margin_left = 30.0
margin_top = -100.0
margin_right = 150.0
margin_bottom = -20.0
rect_pivot_offset = Vector2( 0, 0 )
rect_clip_content = false
focus_mode = 2
mouse_filter = 0
mouse_default_cursor_shape = 0
size_flags_horizontal = 1
size_flags_vertical = 1
custom_fonts/font = ExtResource( 2 )
toggle_mode = false
enabled_focus_mode = 2
shortcut = null
group = null
text = "Back"
flat = false
align = 1
_sections_unfolded = [ "custom_fonts" ]

[node name="MarginContainer" type="MarginContainer" parent="." index="2"]

anchor_left = 0.0
anchor_top = 0.0
anchor_right = 0.0
anchor_bottom = 0.0
margin_right = 8.0
margin_bottom = 40.0
rect_pivot_offset = Vector2( 0, 0 )
rect_clip_content = false
mouse_filter = 0
mouse_default_cursor_shape = 0
size_flags_horizontal = 1
size_flags_vertical = 1
_sections_unfolded = [ "Margin" ]

[node name="ImportWindowBtn" type="Button" parent="." index="3"]

anchor_left = 1.0
anchor_top = 1.0
anchor_right = 1.0
anchor_bottom = 1.0
margin_left = -164.0
margin_top = -100.0
margin_right = -24.0
margin_bottom = -21.0
rect_pivot_offset = Vector2( 0, 0 )
rect_clip_content = false
focus_mode = 2
mouse_filter = 0
mouse_default_cursor_shape = 0
size_flags_horizontal = 1
size_flags_vertical = 1
custom_fonts/font = ExtResource( 2 )
toggle_mode = false
enabled_focus_mode = 2
shortcut = null
group = null
text = "Import"
flat = false
align = 1
_sections_unfolded = [ "custom_fonts" ]

[node name="ScrollContainer" type="ScrollContainer" parent="." index="4"]

anchor_left = 0.0
anchor_top = 0.0
anchor_right = 1.0
anchor_bottom = 1.0
margin_left = 30.0
margin_top = 30.0
margin_right = -24.0
margin_bottom = -120.0
rect_pivot_offset = Vector2( 0, 0 )
rect_clip_content = true
mouse_filter = 0
mouse_default_cursor_shape = 0
size_flags_horizontal = 1
size_flags_vertical = 1
scroll_horizontal_enabled = true
scroll_horizontal = 0
scroll_vertical_enabled = true
scroll_vertical = 0
scroll_deadzone = 0
_sections_unfolded = [ "Scroll" ]

[node name="PuzzleSetList" type="VBoxContainer" parent="ScrollContainer" index="0"]

anchor_left = 0.0
anchor_top = 0.0
anchor_right = 0.0
anchor_bottom = 0.0
margin_right = 970.0
rect_pivot_offset = Vector2( 0, 0 )
rect_clip_content = false
mouse_filter = 1
mouse_default_cursor_shape = 0
size_flags_horizontal = 3
size_flags_vertical = 1
alignment = 0
_sections_unfolded = [ "Anchor", "Grow Direction", "Hint", "Rect", "Size Flags" ]

[connection signal="pressed" from="BackBtn" to="." method="_on_BackBtn_pressed"]

[connection signal="pressed" from="ImportWindowBtn" to="." method="_on_ImportWindowBtn_pressed"]


